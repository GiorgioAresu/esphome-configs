packages:
  base: !include .base.yaml

esphome:
  platformio_options:
    board_build.flash_mode: dio
    board_build.arduino.memory_type: qio_opi
    build_flags: "-DBOARD_HAS_PSRAM"
    board_upload.maximum_ram_size: 524288

esp32:
  board: esp32-s3-devkitc-1
  flash_size: 16MB
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: y
      CONFIG_ESP32S3_DATA_CACHE_64KB: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y
psram:
  speed: 80MHz
  mode: octal

logger:
  hardware_uart: UART0
  # level: WARN

external_components:
  - source: github://sEbola76/gc9503v

output:
  - platform: ledc
    pin: 5
    id: backlight_led
    frequency: 5kHz

light:
  - platform: monochromatic
    output: backlight_led
    name: Backlight
    id: backlight
    restore_mode: ALWAYS_ON
    default_transition_length: 200ms

i2c:
  sda: 15
  scl: 6
  scan: true
  frequency: 400kHz

spi:    #required only for libraries

display:
  - platform: gc9503v
    model: PANLEE
    #update_interval: 1s
    #show_test_card: true
    update_interval: never
    auto_clear_enabled: false
    #show_test_card: true
    id: my_display
    color_order: RGB
    dimensions:
      width: 480
      height: 480  
    de_pin:
      number: 40
      inverted: false
    hsync_pin:
      number: 42
      inverted: false
    vsync_pin:
      number: 41
      inverted: false
      allow_other_uses: true
    pclk_pin: 39
    pclk_inverted: true
    hsync_pulse_width: 10
    hsync_front_porch: 8
    hsync_back_porch: 40
    vsync_pulse_width: 10
    vsync_front_porch: 8
    vsync_back_porch: 40
    data_pins:
      red:
        - 18         # R1
        - 8          # R2
        - 3          # R3
        - 46         # R4
        - 10         # R5
      green:
        - 14         # G0
        - 13         # G1
        - 12         # G2
        - 11         # G3
        - 16         # G4
        - 17         # G5 
      blue:
        - number: 45 # B1
          allow_other_uses: true
        - number: 48 # B2
          allow_other_uses: true
        - 47         # B3
        - 0          # B4
        - 21         # B5
    enable_pin:
      number: 38
      inverted: false
    reset_pin:
      number: 41
      inverted: false
      allow_other_uses: true
    sclk_pin:
      number: 45
      allow_other_uses: true
    mosi_pin:
      number: 48
      allow_other_uses: true

touchscreen:
  - platform: ft63x6
    interrupt_pin: 4
    id: my_touchscreen
    calibration:
      x_min: 0
      x_max: 480
      y_min: 0
      y_max: 480
    on_touch:
      # - logger.log:
      #     format: Touch at (%d, %d) [%d, %d]
      #     args: [touch.x, touch.y, touch.x_raw, touch.y_raw]
      # - script.stop: screen_light
      - script.execute: screen_light
    # on_release:
    #   - light.turn_on:
    #       id: backlight
    #       brightness: 100%

script:
  - id: screen_light
    mode: restart
    then:
      - lvgl.resume:
      - light.turn_on:
          id: backlight
          brightness: 100%          
          transition_length: 1s
      - delay: 30s
      - light.turn_on:
            id: backlight
            brightness: 50%
            transition_length: 2s
      - delay: 15min
      - light.turn_on:
            id: backlight
            brightness: 35%
            transition_length: 5s
      - delay: 15min
      - light.turn_off:
            id: backlight
      - lvgl.pause:
          show_snow: true

# sensor:
#   - platform: htu21d
#     model: sht21
#     temperature:
#       name: "Temperature"
#       id: air_temperature
#       #on_value:
#     humidity:
#       name: "Humidity"
#       id: relative_humidity
#       #on_value:
#     heater:
#       name: "Heater"

lvgl:
  displays:
    - my_display
  touchscreens:
    - my_touchscreen